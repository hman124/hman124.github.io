let elements=[],punctStartCount=0,punctEndCount=0,inputTypes=["Noun","Plural Noun","Verb","Adjective","Color","Part Of The Body","Part Of The Body (Plural)","Person In Room","Person In Room (Female)","Person In Room (Male)","Type Of Liquid","Something Alive","Something Alive (Plural)",'Verb Ending In "Ing"',"A Place","Random Number"],Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,a,l,i,n,o,s,c="",d=0;for(e=Base64._utf8_encode(e);d<e.length;)i=(t=e.charCodeAt(d++))>>2,n=(3&t)<<4|(a=e.charCodeAt(d++))>>4,o=(15&a)<<2|(l=e.charCodeAt(d++))>>6,s=63&l,isNaN(a)?o=s=64:isNaN(l)&&(s=64),c=c+this._keyStr.charAt(i)+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(s);return c},decode:function(e){var t,a,l,i,n,o,s="",c=0;for(e=e.replace(TEST,"");c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(i=this._keyStr.indexOf(e.charAt(c++)))>>4,a=(15&i)<<4|(n=this._keyStr.indexOf(e.charAt(c++)))>>2,l=(3&n)<<6|(o=this._keyStr.indexOf(e.charAt(c++))),s+=String.fromCharCode(t),64!=n&&(s+=String.fromCharCode(a)),64!=o&&(s+=String.fromCharCode(l));return s=Base64._utf8_decode(s)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"n");for(var t="",a=0;a<e.length;a++){var l=e.charCodeAt(a);l<128?t+=String.fromCharCode(l):l>127&&l<2048?(t+=String.fromCharCode(l>>6|192),t+=String.fromCharCode(63&l|128)):(t+=String.fromCharCode(l>>12|224),t+=String.fromCharCode(l>>6&63|128),t+=String.fromCharCode(63&l|128))}return t},_utf8_decode:function(e){for(var t="",a=0,l=c1=c2=0;a<e.length;)(l=e.charCodeAt(a))<128?(t+=String.fromCharCode(l),a++):l>191&&l<224?(c2=e.charCodeAt(a+1),t+=String.fromCharCode((31&l)<<6|63&c2),a+=2):(c2=e.charCodeAt(a+1),c3=e.charCodeAt(a+2),t+=String.fromCharCode((15&l)<<12|(63&c2)<<6|63&c3),a+=3);return t}},madlibs={createElement:(e,t,a)=>{/\S/.test(e)&&("text"===t&&elements.length>0&&elements[elements.length-1].type===t?(elements[elements.length-1].value+=madlibs.smartSpaces($("#newtextvalue").val()),$("[data-id="+(elements.length-1)+"]").append(madlibs.smartSpaces($("#newtextvalue").val())),$("#new"+t+"value").val("")):(a&&(e=madlibs.smartSpaces(e)),$("#elements i").remove(),elements.push(JSON.parse('{"type": "'+t+'", "value": "'+e+'"}')),$("#elements").append($("<div></div>").attr("data-id",elements.length-1).attr("class","view-item").html(t+": "+e)),$("#new"+t+"value").val("")),$("[data-id="+(elements.length-1)+"]").dblclick(e=>{$("#editvalue").val(elements[$(e.target).attr("data-id")].value),$("#newinput").dialog("close"),$("#build").dialog("close"),$("#newtext").dialog("close"),$("#"+elements[$(e.target).attr("data-id")].type).attr("selected",!0),$("#"+elements[$(e.target).attr("data-id")].type).siblings().attr("selected",!1),$("#edit").data("id",$(e.target).attr("data-id")).dialog("open")}))},deleteElement:e=>{elements.splice(e,1),$("[data-id="+e+"]").remove();for(var t=0;t<elements.length;t++)$($("#elements").children().get(t)).attr("data-id",t);$("#editvalue").val("")},editElement:e=>{/\S/.test($("#editvalue").val())?(elements[e].type=$("#type").val(),elements[e].value=$("#editvalue").val(),"text"==$("#type").val()?elements[e].value=madlibs.smartSpaces($("#editvalue").val(),e):"input"==$("#type").val()&&(elements[e].value.startsWith(" ")&&(elements[e].value=elements[e].value.slice(1,elements[e].value.length)),elements[e].value.endsWith(" ")&&(elements[e].value=elements[e].value.slice(0,elements[e].value.length-1))),$("[data-id="+e+"]").html(elements[e].type+": "+$("#editvalue").val()),$("#editvalue").val("")):madlibs.deleteElement(e)},cleanStr:e=>e.replace(/&/,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&apos;").replace(/\\/g,"\\\\").replace(/\"/g,"&quot;"),buildProject:(e,t)=>{$.ajax({url:"template.html",dataType:"html",success:a=>{for(var l=a,i="",n=0;n<elements.length;n++)"input"===elements[n].type?i+='<input type="text" placeholder="'+elements[n].value+'">':"text"===elements[n].type&&(i+='<input type="hidden" value="'+elements[n].value+'">');if(l=(l=l.replace("INPUTS GO HERE",i)).replace(/TITLE GOES HERE/g,e),t){var o=$("<a></a>");o.text("download"),o.attr("href","data:text/html;base64,"+Base64.encode(l)),o.attr("download","Madlibs - "+e+".html"),o.attr("id","downloadFile"),$("body").append(o),document.getElementById("downloadFile").click(),$("#downloadFile").remove()}else window.open("preview#data:text/html;base64,"+Base64.encode(l))},error:(e,t,a)=>{$("<div></div>").text("An error has occurred. Are You connected to the internet?").dialog({title:"Error",autoOpen:!1,width:400,buttons:[{text:"Close",click:function(){$(this).dialog("close")}}]}).dialog("open")}})},smartSpaces:(e,t)=>{if(!$("#smartspacestate").prop("checked"))return madlibs.cleanStr(e);var a=["-","/","_","&"," "];for(i in a)e.endsWith(a[i])||punctEndCount++,e.startsWith(a[i])||punctStartCount++;return punctStartCount===a.length&&elements.length&&0!=t&&(e=" "+e),punctEndCount===a.length&&(e+=" "),punctStartCount=0,punctEndCount=0,madlibs.cleanStr(e)}};$(document).ready(()=>{$("#smartspaces").click(()=>{$("#smartspacestate").click(),$("#smartspacestate").prop("checked")?$("#smartspaces").html('<i class="ui-icon ui-icon-check"></i> Smart Spaces'):$("#smartspaces").html('<i class="ui-icon ui-icon-closethick"></i> Smart Spaces')}),$("#addinput").click(()=>{$("#newinput").dialog("open"),$("#build").dialog("close"),$("#newtext").dialog("close")}),$("#addtext").click(()=>{$("#newinput").dialog("close"),$("#build").dialog("close"),$("#newtext").dialog("open")}),$("#download").click(()=>{elements.length<=1||($("#build").dialog("open"),$("#newinput").dialog("close"),$("#newtext").dialog("close"))}),$("#newinputvalue").autocomplete({source:inputTypes}),$("#newinput").dialog({dialogClass:"no-close",title:"New Input",autoOpen:!1,width:400,height:200,modal:!0,buttons:[{text:"Ok",click:function(){madlibs.createElement($("#newinputvalue").val(),"input",!1),$(this).dialog("close")}},{text:"Cancel",click:function(){$("#newinputvalue").val(""),$(this).dialog("close")}}]}),$("#newtext").dialog({dialogClass:"no-close",title:"New Text Section",autoOpen:!1,width:400,height:200,modal:!0,buttons:[{text:"Ok",click:function(){madlibs.createElement($("#newtextvalue").val(),"text",!0),$(this).dialog("close")}},{text:"Cancel",click:function(){$("#newtextvalue").val(""),$(this).dialog("close")}}]}),$("#build").dialog({dialogClass:"no-close",title:"Finalize This Project",autoOpen:!1,width:400,height:200,modal:!0,buttons:[{html:'<span class="ui-icon ui-icon-newwin"></span> Preview',click:function(){/\S/.test($("#buildtitlevalue").val())&&(madlibs.buildProject($("#buildtitlevalue").val(),!1),$(this).dialog("close"))}},{html:'<span class="ui-icon ui-icon-arrowthickstop-1-s"></span> Download',click:function(){/\S/.test($("#buildtitlevalue").val())&&(madlibs.buildProject($("#buildtitlevalue").val(),!0),$(this).dialog("close"))}},{text:"Cancel",click:function(){$("#buildtitlevalue").val(""),$(this).dialog("close")}}]}),$("#edit").dialog({dialogClass:"no-close",title:"Modify Item",autoOpen:!1,width:400,height:220,modal:!0,buttons:[{text:"Save Changes",click:function(){madlibs.editElement($(this).data("id")),$(this).dialog("close")}},{text:"Delete Item",click:function(){madlibs.deleteElement($(this).data("id")),$(this).dialog("close")}},{text:"Cancel",click:function(){$("#editvalue").val(""),$(this).dialog("close")}}]});(function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e})()&&$("#tapclick").text("(Double-Tap Items To Modify)")}),window.addEventListener("beforeunload",function(e){elements.length>0&&(e.preventDefault(),e.returnValue="")});
